<Window x:Class="VideoGenerator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Image-to-Video Generator" Height="800" Width="1200"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterScreen">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#1976D2" Padding="15">
            <StackPanel>
                <TextBlock Text="Image-to-Video Generator" FontSize="24" FontWeight="Bold" Foreground="White"/>
                <TextBlock Text="AI-powered video generation with SVD and AnimateDiff" FontSize="12" Foreground="#E3F2FD" Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: Input & Parameters -->
            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="5">

                    <!-- Image Input -->
                    <GroupBox Header="Input Image">
                        <StackPanel>
                            <Button Content="Browse Image..." Click="BrowseImage_Click" HorizontalAlignment="Stretch"/>
                            <TextBox Name="ImagePathTextBox" IsReadOnly="True" Margin="5,5,5,0"
                                     Text="No image selected" Height="60" TextWrapping="Wrap"/>
                            <Image Name="PreviewImage" MaxHeight="200" Margin="5"
                                   Stretch="Uniform" Visibility="Collapsed"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Prompt -->
                    <GroupBox Header="Text Prompt (Required)">
                        <StackPanel>
                            <TextBox Name="PromptTextBox" Height="80" TextWrapping="Wrap" AcceptsReturn="True"
                                     ToolTip="Describe the desired video: camera movements, actions, style, etc."/>
                            <TextBlock FontSize="10" Foreground="Gray" Margin="5,2">
                                Examples: "slow cinematic zoom in", "person turning head", "wind blowing"
                            </TextBlock>
                        </StackPanel>
                    </GroupBox>

                    <!-- Negative Prompt -->
                    <GroupBox Header="Negative Prompt (Optional)">
                        <TextBox Name="NegativePromptTextBox" Height="60" TextWrapping="Wrap" AcceptsReturn="True"
                                 ToolTip="Things to avoid in the video"/>
                    </GroupBox>

                    <!-- Model Selection -->
                    <GroupBox Header="Model">
                        <StackPanel>
                            <ComboBox Name="ModelComboBox" SelectionChanged="ModelComboBox_SelectionChanged"
                                      ToolTip="Select AI model for generation"/>
                            <Button Content="Refresh Models" Click="RefreshModels_Click" Margin="5,5,5,0"/>
                            <Button Content="ðŸ”¥ Browse CivitAI Models (NSFW)" Click="BrowseCivitAI_Click"
                                    Background="#E91E63" Foreground="White" Margin="5,5,5,0"
                                    ToolTip="Download additional NSFW-capable models from CivitAI"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Basic Parameters -->
                    <GroupBox Header="Basic Parameters">
                        <StackPanel>
                            <Label Content="Number of Frames:"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Name="NumFramesSlider" Minimum="14" Maximum="120" Value="25"
                                        Width="180" TickFrequency="1" IsSnapToTickEnabled="True"
                                        ValueChanged="Slider_ValueChanged"/>
                                <TextBlock Name="NumFramesValue" Text="25" Width="40" VerticalAlignment="Center" Margin="10,0"/>
                            </StackPanel>

                            <Label Content="FPS (Frames Per Second):"/>
                            <StackPanel Orientation="Horizontal">
                                <Slider Name="FpsSlider" Minimum="6" Maximum="30" Value="8"
                                        Width="180" TickFrequency="2" IsSnapToTickEnabled="True"
                                        ValueChanged="Slider_ValueChanged"/>
                                <TextBlock Name="FpsValue" Text="8" Width="40" VerticalAlignment="Center" Margin="10,0"/>
                            </StackPanel>

                            <Label Content="Resolution:"/>
                            <ComboBox Name="ResolutionComboBox" SelectedIndex="0">
                                <ComboBoxItem Content="512x512 (Square)" Tag="512,512"/>
                                <ComboBoxItem Content="1024x576 (16:9 Widescreen)" Tag="1024,576"/>
                                <ComboBoxItem Content="576x1024 (9:16 Portrait)" Tag="576,1024"/>
                                <ComboBoxItem Content="768x768 (Square HD)" Tag="768,768"/>
                            </ComboBox>

                            <Label Content="Random Seed (-1 for random):"/>
                            <TextBox Name="SeedTextBox" Text="-1" ToolTip="Use same seed for reproducible results"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Advanced Parameters -->
                    <Expander Header="Advanced Parameters" IsExpanded="False" Margin="10,5">
                        <StackPanel>
                            <!-- SVD Parameters -->
                            <GroupBox Name="SvdParametersGroup" Header="SVD Parameters">
                                <StackPanel>
                                    <Label Content="Motion Bucket ID (1-255):"/>
                                    <StackPanel Orientation="Horizontal">
                                        <Slider Name="MotionBucketSlider" Minimum="1" Maximum="255" Value="127"
                                                Width="150" ValueChanged="Slider_ValueChanged"/>
                                        <TextBlock Name="MotionBucketValue" Text="127" Width="40"
                                                   VerticalAlignment="Center" Margin="10,0"/>
                                    </StackPanel>

                                    <Label Content="Decode Chunk Size (2-8):"/>
                                    <ComboBox Name="DecodeChunkSizeComboBox" SelectedIndex="2">
                                        <ComboBoxItem Content="2 (Lowest VRAM)"/>
                                        <ComboBoxItem Content="4 (Balanced)"/>
                                        <ComboBoxItem Content="8 (Fastest)"/>
                                    </ComboBox>
                                </StackPanel>
                            </GroupBox>

                            <!-- AnimateDiff Parameters -->
                            <GroupBox Name="AnimateDiffParametersGroup" Header="AnimateDiff Parameters">
                                <StackPanel>
                                    <Label Content="Guidance Scale (1.0-20.0):"/>
                                    <StackPanel Orientation="Horizontal">
                                        <Slider Name="GuidanceScaleSlider" Minimum="1.0" Maximum="20.0" Value="7.5"
                                                Width="150" TickFrequency="0.5" ValueChanged="Slider_ValueChanged"/>
                                        <TextBlock Name="GuidanceScaleValue" Text="7.5" Width="40"
                                                   VerticalAlignment="Center" Margin="10,0"/>
                                    </StackPanel>

                                    <Label Content="Inference Steps (15-50):"/>
                                    <StackPanel Orientation="Horizontal">
                                        <Slider Name="InferenceStepsSlider" Minimum="15" Maximum="50" Value="25"
                                                Width="150" TickFrequency="5" IsSnapToTickEnabled="True"
                                                ValueChanged="Slider_ValueChanged"/>
                                        <TextBlock Name="InferenceStepsValue" Text="25" Width="40"
                                                   VerticalAlignment="Center" Margin="10,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </GroupBox>
                        </StackPanel>
                    </Expander>
                </StackPanel>
            </ScrollViewer>

            <!-- Right Panel: Output & Preview -->
            <Grid Grid.Column="1" Margin="10,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Video Preview -->
                <Border Grid.Row="0" BorderBrush="#CCCCCC" BorderThickness="2" Margin="5">
                    <Grid>
                        <MediaElement Name="VideoPlayer" LoadedBehavior="Manual" ScrubbingEnabled="True"
                                      Stretch="Uniform" MediaEnded="VideoPlayer_MediaEnded"/>

                        <TextBlock Name="PlaceholderText" Text="Generated video will appear here"
                                   FontSize="16" Foreground="Gray"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>

                        <!-- Video Controls -->
                        <StackPanel VerticalAlignment="Bottom" Background="#DD000000"
                                    Name="VideoControlsPanel" Visibility="Collapsed">
                            <Slider Name="VideoPositionSlider" Margin="10,5"
                                    Minimum="0" Maximum="100" Value="0"
                                    ValueChanged="VideoPositionSlider_ValueChanged"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="5">
                                <Button Content="â–¶ Play" Click="PlayVideo_Click" Width="80" Margin="5"/>
                                <Button Content="â¸ Pause" Click="PauseVideo_Click" Width="80" Margin="5"/>
                                <Button Content="â¹ Stop" Click="StopVideo_Click" Width="80" Margin="5"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Output Info -->
                <GroupBox Grid.Row="1" Header="Generation Output" Margin="5">
                    <StackPanel>
                        <TextBlock Name="OutputInfoTextBlock" Text="Ready to generate video"
                                   TextWrapping="Wrap" MinHeight="60"/>
                        <Button Name="OpenOutputButton" Content="Open Output Folder"
                                Click="OpenOutput_Click" Visibility="Collapsed" Margin="5"/>
                    </StackPanel>
                </GroupBox>
            </Grid>
        </Grid>

        <!-- Bottom Bar: Actions & Progress -->
        <Grid Grid.Row="2" Background="#F5F5F5" Padding="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Progress Bar -->
            <ProgressBar Name="ProgressBar" Grid.Row="0" IsIndeterminate="False"
                         Visibility="Collapsed" Height="25"/>

            <!-- Status Text -->
            <TextBlock Name="StatusText" Grid.Row="1" Text="Ready"
                       Margin="5" FontWeight="SemiBold"/>

            <!-- Action Buttons -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Check VRAM" Click="CheckVram_Click" Margin="5"/>
                <Button Name="GenerateButton" Content="Generate Video"
                        Click="Generate_Click" Margin="5"
                        Background="#4CAF50" FontSize="14" FontWeight="Bold"
                        MinWidth="150" Padding="15,8"/>
                <Button Name="CancelButton" Content="Cancel"
                        Click="Cancel_Click" Margin="5"
                        Background="#F44336" Visibility="Collapsed"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
